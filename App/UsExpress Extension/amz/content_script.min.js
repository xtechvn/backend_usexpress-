const label_id=1,label_name="AMAZON",currency_symbol="$ ";var out_stock,on_loading,btn_onloading,button_redirect_toUSExpress,primarybutton_readytoclick,OrderButton_readytoclick,note_instock,note_outstock,url_usexpress,asin,current_url="",logo_url=chrome.runtime.getURL("/amz/images/logo.png"),ic_cart_url=chrome.runtime.getURL("/amz/images/ic-cart.png"),xpath={};$(document).ready(function(){$.get(chrome.runtime.getURL("/assets/ext_data.json"),function(e){url_usexpress=e.url_usexpress,out_stock=e.HTML.out_stock,on_loading=e.HTML.on_loading,btn_onloading=e.HTML.btn_onloading,button_redirect_toUSExpress=e.HTML.button_redirect_toUSExpress,primarybutton_readytoclick=e.HTML.primarybutton_readytoclick,OrderButton_readytoclick=e.HTML.OrderButton_readytoclick,note_instock=e.HTML.note_instock,note_outstock=e.HTML.note_outstock}),usexpress_amz.GetASINFromCurrentPage(function(e){asin=e,null!=e&&null!=e&&""!=e.replace(/^\s+|\s+$/gm,"")&&$.get(chrome.runtime.getURL("/amz/index.html"),function(e){var t=document.createElement("div");t.className="extension_usexpress";var o=e.replace("{logo_png}",logo_url).replace("{iccart_png}",ic_cart_url).replace("{primarybutton_readytoclick}",primarybutton_readytoclick).replaceAll("{label_name}",label_name);t.innerHTML=o,document.body.appendChild(t),$(".box_pin").css("background","rgba(35, 104, 82, .9) url("+chrome.runtime.getURL("/amz/images/bg-map.png")+") no-repeat"),$("#btn_baogia").text(btn_onloading),$("#btn_baogia").removeClass("bao-gia"),usexpress_amz.DetectPriceRange()})})}),$("body").on("click",".bao-gia",function(e){$(".bao-gia").text(btn_onloading),$("#product_amount").text(on_loading),$("#product_fee_first_pound").html(on_loading),$("#product_fee_after_pound").html(on_loading),$("#luxury_fee").html(on_loading),$("#product_discount_fee").html(on_loading),$("#product_total_shipping_fee").html(on_loading),$("#product_total_amount").html(on_loading),$("#product_fee_us_shipping_fee").html(on_loading),$("#product_total_amount_vnd").html(on_loading),$("#btn_baogia").addClass("disable-click"),$("#more_infomation").html(note_instock),$(".hide-when-out-stock").removeClass("hidden_div"),$(".modal-popup").addClass("show"),$("body").toggleClass("open-popup");var t={function_name:"get_xpath",label_name:label_name};chrome.runtime.sendMessage(t,function(e){if("Success"!=e.response)return $("#product_amount").text(""),$("#product_total_amount_vnd").html(""),$(".bao-gia").text(primarybutton_readytoclick),$(".hide-when-out-stock").addClass("hidden_div"),$("#usexpress_order_confirm").html("<img src="+ic_cart_url+">  "+OrderButton_readytoclick),void $("#more_infomation").html(note_outstock);xpath=e.data;var t=0;$.each(xpath.price,function(e,o){if(xPathResult=document.evaluate(o,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null),null!=xPathResult.singleNodeValue){var a=xPathResult.singleNodeValue.innerHTML;if(t=parseFloat(a.replace("$","").replace(",","")),t>0)return!1}});var o="1 pounds";$.each(xpath.item_weight,function(e,t){for(var a,n=document.evaluate(t,document,null,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);null!=(a=n.iterateNext());){if(a.textContent.includes("Item Weight")){o=a.textContent.replace("Item Weight","").replace("\n","").replace(":","").replace(/^\s+|\s+$/gm,"");break}if(a.textContent.includes("Package Dimensions")){if(o=a.textContent.replace("\n","").replace(":","").split(";")[1],null!=o)break;o="1 pounds"}else;}});var a=o.replace(/^\s+|\s+$/gm,"").replace(/\r?\n|\r/gm,"").split(" "),n="";xpath.product_name.length>0&&$.each(xpath.product_name,function(e,t){if(xPathResult=document.evaluate(t,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null),null!=xPathResult.singleNodeValue)return n=xPathResult.singleNodeValue.innerHTML,!1});var r=0;xPathResult=document.evaluate(xpath.shipping_fee,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null),null!=xPathResult.singleNodeValue&&(r=parseFloat(xPathResult.singleNodeValue.innerHTML.replace("$","").replace(",","")));var l={function_name:"get_fee_new",price:t,item_weight:parseFloat(a[0].replace(/[^0-9.+-]/g,"")),unit:a[1],product_name:n,shipping_fee:r,url:window.location.href,label_id:label_id};chrome.runtime.sendMessage(l,function(e){if("Success"!=e.response)return $("#product_total_amount_vnd").html(""),$(".bao-gia").text(primarybutton_readytoclick),$(".hide-when-out-stock").addClass("hidden_div"),$("#usexpress_order_confirm").html("<img src="+ic_cart_url+">  "+OrderButton_readytoclick),void $("#more_infomation").html(note_outstock);var t=/^[0-9]*\.?[0-9]*$/,o=""+e.PRICE;o=o.match(t),parseFloat(o)?$("#product_amount").html(currency_symbol+usexpress_amz.numberWithCommas(Number(o).toFixed(2))):$("#product_amount").html(out_stock),parseFloat(r)?$("#product_fee_us_shipping_fee").html(currency_symbol+usexpress_jomashop.numberWithCommas(Number(r).toFixed(0))):$("#product_fee_us_shipping_fee").html(""),e.TOTAL_SHIPPING_FEE>0?$("#product_total_shipping_fee").html(currency_symbol+usexpress_amz.numberWithCommas(e.TOTAL_SHIPPING_FEE)):$("#product_total_shipping_fee").html(""),e.PRICE_LAST>0?$("#product_total_amount").html(currency_symbol+usexpress_amz.numberWithCommas(e.PRICE_LAST)):$("#product_total_amount").html(""),e.FIRST_POUND_FEE>0?$("#product_fee_first_pound").html(currency_symbol+usexpress_amz.numberWithCommas(e.FIRST_POUND_FEE)):$("#product_fee_first_pound").html(""),e.NEXT_POUND_FEE>0?$("#product_fee_after_pound").html(currency_symbol+usexpress_amz.numberWithCommas(e.NEXT_POUND_FEE)):$("#product_fee_after_pound").html(""),e.LUXURY_FEE>0?$("#luxury_fee").html(currency_symbol+usexpress_amz.numberWithCommas(e.LUXURY_FEE)):$("#luxury_fee").html(""),e.PRICE_LAST_VND>0?($("#product_total_amount_vnd").html(usexpress_amz.numberWithCommas(e.PRICE_LAST_VND)+" đ"),$(".bao-gia").text(primarybutton_readytoclick),$("#usexpress_order_confirm").html("<img src="+ic_cart_url+">  "+OrderButton_readytoclick),$("#more_infomation").html(note_instock)):($("#product_total_amount_vnd").html(""),$(".bao-gia").text(primarybutton_readytoclick),$(".hide-when-out-stock").addClass("hidden_div"),$("#usexpress_order_confirm").html("<img src="+ic_cart_url+">  "+OrderButton_readytoclick),$("#more_infomation").html(note_outstock)),$("#usexpress_order_confirm").removeClass("bg-gray"),url_usexpress=e.url_usexpress_detail,$("#btn_baogia").removeClass("disable-click"),$("#btn_baogia").addClass("close-popup"),$("#btn_baogia").removeClass("bao-gia")})})}),$("body").on("click",".close-popup",function(e){$(".modal-popup").removeClass("show"),$("body").removeClass("open-popup"),$("#btn_baogia").removeClass("close-popup"),$("#btn_baogia").addClass("bao-gia")}),$("body").on("click",".usexpress_order_confirm",function(){var e=window.open(url_usexpress,"US Express");e?e.focus():alert("Please allow popups for extension (Website)")});var usexpress_amz={GetASINFromCurrentPage:function(e){chrome.runtime.sendMessage({function_name:"get_product_code",label_id:label_id,url:window.location.href},function(t){e(t.product_code)})},DetectPriceRange:function(){var e=setInterval(function(){var t=document.evaluate('//*[@class="a-price-range"]',document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null);null!=t.singleNodeValue?($("#btn_baogia").removeClass("bao-gia"),$("#btn_baogia").html("Vui lòng chọn kích cỡ / màu sắc"),$("#btn_baogia").addClass("close-popup"),$("#btn_baogia").addClass("disable-click")):usexpress_amz.GetASINFromCurrentPage(function(t){asin=t,$("#btn_baogia").removeClass("close-popup"),$("#btn_baogia").addClass("bao-gia"),$("#btn_baogia").text(primarybutton_readytoclick),$("#btn_baogia").removeClass("disable-click"),clearInterval(e)})},2e3)},numberWithCommas:function(e){var t=Number(e).toFixed(2);return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}};