const label_id=7,label_name="JOMASHOP",currency_symbol="$ ",grey_background_html='<div class="modal-backdrop close-popup"></div>';var out_stock,on_loading,btn_onloading,button_redirect_toUSExpress,primarybutton_readytoclick,OrderButton_readytoclick,note_instock,note_outstock,url_usexpress,asin,extension_showup_interval,href_interval,current_url="",logo_url=chrome.runtime.getURL("/amz/images/logo.png"),ic_cart_url=chrome.runtime.getURL("/amz/images/ic-cart.png"),xpath={},product_url="";$(document).ready(function(){$.get(chrome.runtime.getURL("/assets/ext_data.json"),function(e){url_usexpress=e.url_usexpress,out_stock=e.HTML.out_stock,on_loading=e.HTML.on_loading,btn_onloading=e.HTML.btn_onloading,button_redirect_toUSExpress=e.HTML.button_redirect_toUSExpress,primarybutton_readytoclick=e.HTML.primarybutton_readytoclick,OrderButton_readytoclick=e.HTML.OrderButton_readytoclick,note_instock=e.HTML.note_instock,note_outstock=e.HTML.note_outstock}),usexpress_jomashop.GetASINFromCurrentPage(function(e){asin=e,null!=e&&null!=e&&""!=e.replace(/^\s+|\s+$/gm,"")&&$.get(chrome.runtime.getURL("/amz/index.html"),function(e){extension_showup_interval=setInterval(function(){""!=product_url&&window.location.href==product_url||($(".extension_usexpress").remove(),usexpress_jomashop.CheckIfProductDetailPage(e))},3e3)})})}),$("body").on("click",".bao-gia",function(e){$(".bao-gia").text(btn_onloading),$("#product_amount").text(on_loading),$("#product_fee_first_pound").html(on_loading),$("#product_fee_after_pound").html(on_loading),$("#luxury_fee").html(on_loading),$("#product_discount_fee").html(on_loading),$("#product_total_shipping_fee").html(on_loading),$("#product_total_amount").html(on_loading),$("#product_fee_us_shipping_fee").html(on_loading),$("#product_total_amount_vnd").html(on_loading),$("#btn_baogia").addClass("disable-click"),$("#more_infomation").html(note_instock),$(".hide-when-out-stock").removeClass("hidden_div"),$(".modal-popup").addClass("show"),$("body").toggleClass("open-popup"),$("body").append(grey_background_html);var t={function_name:"get_xpath",label_name:label_name};chrome.runtime.sendMessage(t,function(e){if("Success"!=e.response)return $("#product_amount").text(""),$("#product_total_amount_vnd").html(""),$(".bao-gia").text(primarybutton_readytoclick),$(".hide-when-out-stock").addClass("hidden_div"),$("#usexpress_order_confirm").html("<img src="+ic_cart_url+">  "+OrderButton_readytoclick),void $("#more_infomation").html(note_outstock);xpath=e.data;var t=0;$.each(xpath.price,function(e,o){if(xPathResult=document.evaluate(o,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null),null!=xPathResult.singleNodeValue){var a=xPathResult.singleNodeValue.innerHTML;if(t=parseFloat(a.replace("$","").replace(",","")),t>0)return!1}});var o="1 pounds",a=o.split(" "),n="";xpath.product_name.length>0&&$.each(xpath.product_name,function(e,t){if(xPathResult=document.evaluate(t,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null),null!=xPathResult.singleNodeValue)return n=xPathResult.singleNodeValue.innerHTML,!1});var r=0;if(xPathResult=document.evaluate(xpath.shipping_fee,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null),null!=xPathResult.singleNodeValue){var l=xPathResult.singleNodeValue.innerHTML.split("<")[0].toLowerCase();l.includes("free")||(r=parseFloat(l.replace("shipped","").replace("$","").replace(",","")))}var s={function_name:"get_fee_new",price:t,item_weight:parseFloat(a[0].replace(/[^0-9.+-]/g,"")),unit:a[1],product_name:n,shipping_fee:0,url:window.location.href,label_id:label_id};chrome.runtime.sendMessage(s,function(e){var t=/^[0-9]*\.?[0-9]*$/,o=""+e.PRICE;o=o.match(t),parseFloat(o)?$("#product_amount").html(currency_symbol+usexpress_jomashop.numberWithCommas(Number(o).toFixed(2))):$("#product_amount").html(out_stock),parseFloat(r)?$("#product_fee_us_shipping_fee").html(currency_symbol+usexpress_jomashop.numberWithCommas(Number(r).toFixed(0))):$("#product_fee_us_shipping_fee").html(""),e.TOTAL_SHIPPING_FEE>0?$("#product_total_shipping_fee").html(currency_symbol+usexpress_jomashop.numberWithCommas(e.TOTAL_SHIPPING_FEE)):$("#product_total_shipping_fee").html(""),e.PRICE_LAST>0?$("#product_total_amount").html(currency_symbol+usexpress_jomashop.numberWithCommas(e.PRICE_LAST)):$("#product_total_amount").html(""),e.FIRST_POUND_FEE>0?$("#product_fee_first_pound").html(currency_symbol+usexpress_jomashop.numberWithCommas(e.FIRST_POUND_FEE)):$("#product_fee_first_pound").html(""),e.NEXT_POUND_FEE>0?$("#product_fee_after_pound").html(currency_symbol+usexpress_jomashop.numberWithCommas(e.NEXT_POUND_FEE)):$("#product_fee_after_pound").html(""),e.LUXURY_FEE>0?$("#luxury_fee").html(currency_symbol+usexpress_jomashop.numberWithCommas(e.LUXURY_FEE)):$("#luxury_fee").html(""),e.PRICE_LAST_VND>0?($("#product_total_amount_vnd").html(usexpress_jomashop.numberWithCommas(e.PRICE_LAST_VND)+" đ"),$(".bao-gia").text(primarybutton_readytoclick),$("#usexpress_order_confirm").html("<img src="+ic_cart_url+">  "+OrderButton_readytoclick),$("#more_infomation").html(note_instock)):($("#product_total_amount_vnd").html(""),$(".bao-gia").text(primarybutton_readytoclick),$(".hide-when-out-stock").addClass("hidden_div"),$("#usexpress_order_confirm").html("<img src="+ic_cart_url+">  "+OrderButton_readytoclick),$("#more_infomation").html(note_outstock)),$("#usexpress_order_confirm").removeClass("bg-gray"),url_usexpress=e.url_usexpress_detail,$("#btn_baogia").removeClass("disable-click"),$("#btn_baogia").addClass("close-popup"),$("#btn_baogia").removeClass("bao-gia")})})}),$("body").on("click",".close-popup",function(e){$(".modal-popup").removeClass("show"),$("body").removeClass("open-popup"),$("#btn_baogia").removeClass("close-popup"),$("#btn_baogia").addClass("bao-gia"),$(".modal-backdrop").remove()}),$("body").on("click",".usexpress_order_confirm",function(){var e=window.open(url_usexpress,"US Express");e?e.focus():alert("Please allow popups for extension (Website)")});var usexpress_jomashop={GetASINFromCurrentPage:function(e){chrome.runtime.sendMessage({function_name:"get_product_code",label_id:label_id,url:window.location.href},function(t){e(t.product_code)})},DetectPriceRange:function(){var e=setInterval(function(){var t=document.evaluate('//*[@class="a-price-range"]',document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null);null!=t.singleNodeValue?($("#btn_baogia").removeClass("bao-gia"),$("#btn_baogia").html("Vui lòng chọn kích cỡ / màu sắc"),$("#btn_baogia").addClass("close-popup"),$("#btn_baogia").addClass("disable-click")):usexpress_jomashop.GetASINFromCurrentPage(function(t){asin=t,$("#btn_baogia").removeClass("close-popup"),$("#btn_baogia").addClass("bao-gia"),$("#btn_baogia").text(primarybutton_readytoclick),$("#btn_baogia").removeClass("disable-click"),clearInterval(e)})},2e3)},numberWithCommas:function(e){var t=Number(e).toFixed(2);return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},RenderHTML:function(e){var t=document.createElement("div");t.className="extension_usexpress";var o=e.replace("{logo_png}",logo_url).replace("{iccart_png}",ic_cart_url).replace("{primarybutton_readytoclick}",primarybutton_readytoclick).replaceAll("{label_name}",label_name);t.innerHTML=o,document.body.appendChild(t),$(".modal-backdrop").remove(),$(".box_pin").css("background","rgba(35, 104, 82, .9) url("+chrome.runtime.getURL("/amz/images/bg-map.png")+") no-repeat"),$("#btn_baogia").text(btn_onloading),$("#btn_baogia").removeClass("bao-gia"),usexpress_jomashop.DetectPriceRange(),product_url=window.location.href},CheckIfProductDetailPage:function(e){if(null==xpath.product_description){var t={function_name:"get_xpath",label_name:label_name};chrome.runtime.sendMessage(t,function(t){"Success"==t.response&&null!=t.data&&null!=t.data.product_description&&(xpath=t.data,xpath.product_description.length>0&&$.each(xpath.product_description,function(t,o){if(xPathResult=document.evaluate(o,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null),null!=xPathResult.singleNodeValue)return usexpress_jomashop.RenderHTML(e),product_url=window.location.href,!1}))})}else null!=xpath&&xpath.product_description.length>0&&$.each(xpath.product_description,function(t,o){if(xPathResult=document.evaluate(o,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null),null!=xPathResult.singleNodeValue)return usexpress_jomashop.RenderHTML(e),product_url=window.location.href,!1})}};